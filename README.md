# ChallengeBox

Frontend for the Challenge Application that supplies you with new challenges every day.

To build the project yourself you need a local Wildfly server, Maven, and a Java JDK of course. 

You *could* run just the application server itself, but the server needs a MariaDB. You can choose to setup the MariaDB
locally in conjunction with a modification of your Wildfly server (see instructions for "Local setup"). Or you just
use the prepared docker-compose files (see instructions for "Setup with Docker"), which is the recommended way.

## Setup with Docker

For the following you need [Docker](https://docs.docker.com/install/) and
[docker-compose](https://docs.docker.com/compose/install/) installed.

### Just run the application (without build)
In case you don't want to build the application by yourself, you only have to download the `./docker/docker-compose.yml`
and the `./docker/docker-compose.hub.yml`. Place these files in the same directory and run:
```
docker-compose -f docker-compose.yml -f docker-compose.hub.yml up
```
This loads the Docker images from Docker Hub, creates and starts the containers based from these images for the MariaDB
database and Wildfly application server.

Don't forget to shutdown and remove the containers after use. Run (from a different console or after killing the 
containers with STRG+C):
```console
docker-compose down
```

### Build and run the application

First of course, clone this repository:
```console
foo@bar:~$ git clone https://github.com/MakroCow/ChallengeBox.git
foo@bar:~$ cd ./ChallengeBox
```

Next, we have to build our `challengeBox.war`. You can use your local Maven installation for that (which is faster and
therefore recommended). Or you use the official Maven Docker image, which creates the `target` directory etc. for you:
```console
foo@bar:~/ChallengeBox$ docker run -it --rm --name my-maven-project -v "$(pwd)":/usr/src/mymaven -w /usr/src/mymaven maven:3.3-jdk-8 mvn clean install
```

Finally we can deploy the `challengeBox.war`. The repository holds a little docker-compose.yml which makes the deploy
more convenient. You will need [docker-compose](https://docs.docker.com/compose/install/) installed.

Just let docker-compose let the magic happen (this might take a while for the first time):
```console
foo@bar:~/ChallengeBox$ cd ./docker
foo@bar:~/ChallengeBox/docker$ docker-compose up
```

**Note for \*nix users:** 
* Wildfly doesn't have write rights on the target directory, since it was generated by the Maven
container, which was run as root user. Therefore the following error could occur in your Wildfly server if it expects
write rights:
* `
ERROR [org.jboss.as.server.deployment.scanner] (DeploymentScanner-threads - 1) WFLYDS0042: Boot-time scan failed due to
 inaccessible deployment directory: /opt/jboss/wildfly/standalone/deployments
`
* Due to this you may have to change the rights of the mounted `target` directory to your user, since the Maven 
container can't be run without root.

Since the deployment checker of Wildfly is activated it will recognize new deployments. Just let Maven create the
challengBox.war and Wildfly will redeploy your code soon. ;-)

Don't forget to shutdown and remove the containers after use. Run (from a different console or after killing the 
containers with STRG+C):
```console
foo@bar:~/ChallengeBox/docker$ docker-compose down
```


## Local setup
* Install Wildfly 16.0.0 Final from [https://wildfly.org/downloads/](https://wildfly.org/downloads/) (extract the
download to a preferred directory)
* Copy the `mysql-connector-java-8.0.16.jar` and the `module.xml` (located under `./docker/`) to 
`<wildfly-installation-folder>/modules/com/mysql/main/`
under your Wildfly installation folder.
This is the driver which enables the server to connect to MariaDB.
* Copy the `standalone-custom.xml` (located under `./docker/`) to 
`<wildfly-installation-folder>/standalone/configuration/`
under your Wildfly installation folder.
This holds a special configuration which tells the server to connect to MariaDB.
* Edit the copied standalone-custom.xml: Search for `db:3306` and exchange it with `localhost:3306`. This was needed,
because `db` was Docker specific.
* Install MariaDB Server ([https://mariadb.com/downloads/](https://mariadb.com/downloads/)) and start MariaDB
 (Windows: locate installation folder and run the ./bin/mysqld.exe)
* Edit 'Run Configurations' to: 
     - Application Server: JBoss 8.0.0.Final
     - Open Browser: Use your favorite browser
     - VM Options: --add-modules java.se
     - JRE: Default 
     - Add the challengeBox.war under the deployment tab (in IntelliJ IDE)
* Connect with the database (username and password: `root`): in IntelliJ IDE: tab Database > "+" >
Data Source > MariaDB
* Add a scheme with the name "challengeboxdb" to the database
* Start Wildfly: `<wildfly-installation-folder>/bin/standalone.bat` (Windows) or
 `wildfly-installation-folder/bin/standalone.sh` (Linux)
* In Intellij das Hibernate Facet hinzufügen, damit die Symbole in JPA erkannt werden. Dafür `/src/main/java/resources/META-INF/persistence.xml` öffnen und im Pop-Up das Facet von Intellij hinzufügen lassen. 

## Erste Schritte
`http://localhost:8080/challengeBox/api/helloworld/fillWithExampleData` aufrufen, dann werden Beispieldaten in die Datenbank geschrieben

## Endpunkte 
Diese Endpunkte sind nur zu Testzwecken und beispielhafter Darstellung angelegt worden
- `api/helloworld/1` - Alle Challenges ausgeben
- `api/helloworld/2/5` - Challenge mit der jeweiligen id (hier 5) ausgeben

## Swagger 
Endpoint Config ist unter `http://localhost:8080/challengeBox/api/openapi.json` und `http://localhost:8080/challengeBox/api/openapi.yaml` verfügbar. 
Zur Visualisierung und Clientgenerierung für Angular auf der Seite von `https://editor.swagger.io/` die .json einfügen und Client herunterladen (unter `>Generate Client`). 